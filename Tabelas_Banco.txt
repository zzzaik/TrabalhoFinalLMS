Use DB_LMS_postgreSQL
GO

Create table cursos (
	id int identity(1, 1) not null,
	sigla_curso varchar(5) not null,
	nome_curso varchar(50) not null,
	constraint pkCurso PRIMARY KEY (id),
	constraint ucCurso UNIQUE (sigla_curso),
	constraint ucCurso_2 UNIQUE (nome_curso)	
)

Create table grade_curricular (
	id int identity(1, 1) not null,
	sigla_curso int,
	ano_grade smallint,
	semestre_grade char(1)
	constraint pk_GradeCurricular primary key (id),
	constraint uc_GradeCurricular unique (sigla_curso, ano_grade, semestre_grade),
	constraint fk_GradeCurricular foreign key (sigla_curso) references cursos (id)
)

Create table periodo (
	id int identity (1, 1) not null,
	sigla_curso int,
	ano_grade int,
	semestre_grade int,
	numero_periodo tinyint,
	constraint pkPeriodo primary key (id),
	constraint ucPeriodo unique (sigla_curso, ano_grade, semestre_grade, numero_periodo),
	constraint fkPeriodo foreign key (sigla_curso) references cursos (id),
	constraint fkPeriodo_2 foreign key (ano_grade) references grade_curricular (id),
	constraint fkPeriodo_3 foreign key (semestre_grade) references grade_curricular (id)
)

Create table disciplina (
	id int identity (1, 1) not null,
	nome_disciplina varchar(240),
	carga_horaria tinyint,
	teoria_disciplina decimal(3),
	pratica_disciplina decimal(3),
	ementa_disciplina text,
	competencias_disciplina text,
	habilidades_disciplina text,
	conteudo_disciplina text,
	bibliografia_basica_disciplina text,
	bibliografia_complementar_disciplina text,
	constraint pkDisciplina primary key (id),
	constraint ucDisciplina unique (nome_disciplina)
)

--Criar essa parte somente ap√≥s dar o migrate inicial no django

Create table periodo_disciplina (
	id int identity (1, 1) not null,
	sigla_curso int,
	ano_grade int,
	semestre_grade int,
	numero_periodo int,
	nome_disciplina int,
	constraint pkPeriodoDisciplina primary key (id),
	constraint ucPeriodoDisciplina unique (sigla_curso, ano_grade, semestre_grade,
numero_periodo, nome_disciplina),
	constraint fkPeriodoDisciplina foreign key (sigla_curso) references cursos (id),
	constraint fkPeriodoDisciplina_2 foreign key (ano_grade) references grade_curricular (id),
	constraint fkPeriodoDisciplina_3 foreign key (semestre_grade) references grade_curricular (id),
	constraint fkPeriodoDisciplina_4 foreign key (nome_disciplina) references disciplina (id)
)

Create table disciplina_ofertada (
	id int identity (1, 1) not null,
	nome_disciplina int,
	ano_disciplina_ofertada smallint,
	semestre_disciplina_ofertada char(1),
	constraint pkDisciplinaOfertada primary key (id),
	constraint ucDisciplinaOfertada unique (nome_disciplina, ano_disciplina_ofertada, semestre_disciplina_ofertada),
	constraint fkDisciplinaOfertada foreign key (nome_disciplina) references disciplina (id)
)

Create table turma (
	id int identity (1, 1) not null,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma char(1),
	turno varchar(15),
	ra_professor int,
	constraint pkturma primary key (id),
	constraint ucturma unique (nome_disciplina, ano_ofertado, semestre_ofertado),
	constraint ucturma_2 unique (id_turma),
	constraint fkturma foreign key (nome_disciplina) references disciplina (id),
	constraint fkturma_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkturma_3 foreign key (semestre_ofertado) references disciplina_ofertada(id),
	constraint fkturma_4 foreign key (ra_professor) references core_professor (user_id)
)

Create table matricula (
	id int identity (1, 1) not null,
	ra_aluno int,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	constraint pkmatricula primary key (id),
	constraint ucmatricula unique (ra_aluno, nome_disciplina, ano_ofertado, semestre_ofertado, id_turma),
	constraint fkmatricula foreign key (ra_aluno) references core_aluno (user_id),
	constraint fkmatricula_2 foreign key (nome_disciplina) references disciplina (id),
	constraint fkmatricula_3 foreign key (ano_ofertado) references disciplina_ofertada (id),	
	constraint fkmatricula_4 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkmatricula_5 foreign key (id_turma) references turma (id)
)

Create table curso_turma (
	id int identity (1, 1) not null,
	sigla_curso int,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	constraint pkCursoTurma primary key (id),
	constraint ucCursoTurma unique (sigla_curso, nome_disciplina, ano_ofertado, semestre_ofertado, id_turma),
	constraint fkCursoTurma foreign key (sigla_curso) references cursos (id),
	constraint fkCursoTurma_2 foreign key (nome_disciplina) references disciplina (id),
	constraint fkCursoTurma_3 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkCursoTurma_4 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkCursoTurma_5 foreign key (id_turma) references turma (id)
)

Create table questao (
	id int identity (1, 1) not null,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	numero_questao int,
	data_limite_entrega date,
	descricao text,
	data date,
	constraint pkquestao primary key (id),
	constraint ucquestao unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao),
	constraint fkquestao foreign key (nome_disciplina) references disciplina(id),
	constraint fkquestao_2 foreign key (ano_ofertado) references disciplina_ofertada (id),	
	constraint fkquestao_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkquestao_4 foreign key (id_turma) references turma (id)
)

Create table arquivo_questao (
	id int identity (1, 1) not null,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	numero_questao int,
	arquivo_questao varchar(500),
	constraint pkArquivoQuestao primary key (id),
	constraint ucArquivoQuestao unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao, arquivo_questao),
	constraint fkArquivoQuestao foreign key (nome_disciplina) references disciplina (id),
	constraint fkArquivoQuestao_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkArquivoQuestao_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkArquivoQuestao_4 foreign key (id_turma) references turma (id),
	constraint fkArquivoQuestao_5 foreign key (numero_questao) references questao (id)
)

Create table resposta (
	id int identity (1, 1) not null,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	numero_questao int,
	ra_aluno int,
	data_avaliacao date,
	nota decimal(4,2),
	avaliacao text,
	descricao text,
	data_de_envio date,
	constraint pkresposta primary key (id),
	constraint ucresposta unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao, ra_aluno),
	constraint fkresposta foreign key (nome_disciplina) references disciplina (id),
	constraint fkresposta_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkresposta_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkresposta_4 foreign key (id_turma) references turma (id),
	constraint fkresposta_5 foreign key (numero_questao) references questao (id)
)

create table arquivo_resposta (
	id int identity (1, 1) not null,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	numero_questao int,
	ra_aluno int,
	arquivo_resposta varchar (500),
	constraint pkArquivosResposta primary key (id),
	constraint ucArquivosResposta unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao, ra_aluno, arquivo_resposta),
	constraint fkArquivosResposta foreign key (nome_disciplina) references disciplina (id),
	constraint fkArquivosResposta_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkArquivosResposta_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkArquivosResposta_4 foreign key (id_turma) references turma (id),
	constraint fkArquivosResposta_5 foreign key (numero_questao) references questao (id),
	constraint fkArquivosResposta_6 foreign key (ra_aluno) references core_aluno (user_id)
)

create table codigo_matricula(
	id int identity (1, 1) not null,
	id_aluno integer not null,
	sigla_curso varchar(5) not null,      
	codigo varchar(10) not null,
	status bit,
	constraint uccodigo_matricula unique (id_aluno, sigla_curso, codigo),
	constraint fkcodigo_matricula foreign key (id_aluno) references core_aluno (user_id)
)

SELECT * FROM cursos
SELECT * FROM disciplina
SELECT * FROM matricula
SELECT * FROM core_usuario
SELECT * FROM core_aluno
SELECT * FROM core_professor
SELECT * FROM arquivo_resposta
SELECT * FROM arquivo_questao
SELECT * FROM CursoTurma
SELECT * FROM grade_curricular
SELECT * FROM questao
SELECT * FROM resposta
SELECT * FROM disciplina_ofertada
SELECT * FROM periodo
SELECT * FROM periodo_disciplina
SELECT * FROM turma
SELECT * FROM codigo_matricula


