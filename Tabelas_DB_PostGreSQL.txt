CREATE TABLE curso (
    id serial NOT NULL,
    sigla VARCHAR(5) NOT NULL,
    nome VARCHAR(50) NOT NULL,
    CONSTRAINT pkCurso PRIMARY KEY (id),
    CONSTRAINT unkCurso UNIQUE (sigla),
    CONSTRAINT unkCurso2 UNIQUE (nome)
);

CREATE TABLE disciplina (
	id serial NOT NULL,
    nome VARCHAR(240) NOT NULL,
    carga_horaria SMALLINT NOT NULL,
    aula_teorica DECIMAL(10, 3) NOT NULL,
    aula_pratica DECIMAL(10, 3) NOT NULL,
    ementa TEXT,
    competencias TEXT,
	habilidades TEXT,
    conteudo TEXT,
    bibliografia_basica TEXT,
    bibliografia_complementar TEXT,
	CONSTRAINT pkDisciplina PRIMARY KEY (id),
	CONSTRAINT unkDisciplina UNIQUE (nome)
);

CREATE TABLE disciplina_ofertada (
	id serial NOT NULL,
	nome_disciplina INT NOT NULL,
	ano SMALLINT NOT NULL,
	semestre CHAR(1) NOT NULL,
	CONSTRAINT pkDisciplinaOfertada PRIMARY KEY (id),
	CONSTRAINT fkDisciplinaOfertada FOREIGN KEY (nome_disciplina) REFERENCES disciplina (id),
	CONSTRAINT unkDisciplinaOfertada UNIQUE (nome_disciplina, ano, semestre)
);

CREATE TABLE Turma (
	id serial NOT NULL,
	num_turma CHAR(2) NOT NULL,
	ra_professor INT NOT NULL,
	nome_disciplina INT NOT NULL,
	ano_ofertado INT NOT NULL,
	semestre_ofertado INT NOT NULL,
	turno VARCHAR(15) NOT NULL,
	CONSTRAINT pkTurma PRIMARY KEY (id),
	CONSTRAINT fkTurma FOREIGN KEY (ra_professor) REFERENCES core_professor (user_id),
	CONSTRAINT fkTurma2 FOREIGN KEY (nome_disciplina) REFERENCES disciplina_ofertada (id),
	CONSTRAINT fkTurma3 FOREIGN KEY (ano_ofertado) REFERENCES disciplina_ofertada (id),
	CONSTRAINT fkTurma4 FOREIGN KEY (semestre_ofertado)  REFERENCES disciplina_ofertada (id),
	CONSTRAINT unkTurma UNIQUE (num_turma, nome_disciplina, ano_ofertado, semestre_ofertado)
);

Create table grade_curricular (
	id serial not null,
	sigla_curso int not null,
	ano_grade smallint not null,
	quantidade_semestres char(1) not null,
	constraint pk_GradeCurricular primary key (id),
	constraint uc_GradeCurricular unique (sigla_curso, ano_grade, quantidade_semestres),
	constraint fk_GradeCurricular foreign key (sigla_curso) references curso (id)
);

Create table periodo (
	id serial not null,
	sigla_curso int not null,
	ano_grade int not null,
	quantidade_semestres_grade int not null,
	numero_periodo smallint not null,
	constraint pkPeriodo primary key (id),
	constraint ucPeriodo unique (sigla_curso, ano_grade, quantidade_semestres_grade, numero_periodo),
	constraint fkPeriodo foreign key (sigla_curso) references curso (id),
	constraint fkPeriodo_2 foreign key (ano_grade) references grade_curricular (id),
	constraint fkPeriodo_3 foreign key (quantidade_semestres_grade) references grade_curricular (id)
);

Create table periodo_disciplina (
	id serial not null,
	sigla_curso int not null,
	ano_grade int not null,
	quantidade_semestres_grade int not null,
	numero_periodo int not null,
	nome_disciplina int not null,
	constraint pkPeriodoDisciplina primary key (id),
	constraint ucPeriodoDisciplina unique (sigla_curso, ano_grade, quantidade_semestres_grade ,numero_periodo, nome_disciplina),
	constraint fkPeriodoDisciplina foreign key (sigla_curso) references curso (id),
	constraint fkPeriodoDisciplina_2 foreign key (ano_grade) references grade_curricular (id),
	constraint fkPeriodoDisciplina_3 foreign key (quantidade_semestres_grade) references grade_curricular (id),
	constraint fkPeriodoDisciplina_4 foreign key (nome_disciplina) references disciplina (id),
	CONSTRAINT fkPeriodoDisciplina_5 foreign key (numero_periodo) references periodo (id)
);


Create table questao (
	id serial not null,
	nome_disciplina int not null,
	ano_ofertado int not null,
	semestre_ofertado int not null,
	id_turma int not null,
	numero_questao int not null,
	data_limite_entrega date not null,
	descricao text,
	data_questao date not null,
	constraint pkquestao primary key (id),
	constraint unkquestao unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao),
	constraint fkquestao foreign key (nome_disciplina) references disciplina(id),
	constraint fkquestao_2 foreign key (ano_ofertado) references disciplina_ofertada (id),	
	constraint fkquestao_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkquestao_4 foreign key (id_turma) references turma (id)
);

Create table arquivo_questao (
	id serial not null,
	nome_disciplina int not null,
	ano_ofertado int not null,
	semestre_ofertado int not null,
	id_turma int not null,
	numero_questao int not null,
	arquivo_questao varchar(500) not null,
	constraint pkArquivoQuestao primary key (id),
	constraint ucArquivoQuestao unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao, arquivo_questao),
	constraint fkArquivoQuestao foreign key (nome_disciplina) references disciplina (id),
	constraint fkArquivoQuestao_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkArquivoQuestao_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkArquivoQuestao_4 foreign key (id_turma) references turma (id),
	constraint fkArquivoQuestao_5 foreign key (numero_questao) references questao (id)
);

Create table resposta (
	id serial not null,
	nome_disciplina int not null,
	ano_ofertado int not null,
	semestre_ofertado int not null,
	id_turma int not null,
	numero_questao int not null,
	ra_aluno int not null,
	data_avaliacao date not null,
	nota decimal(4,2) not null,
	avaliacao text not null,
	descricao text not null,
	data_de_envio date not null,
	constraint pkresposta primary key (id),
	constraint ucresposta unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao, ra_aluno),
	constraint fkresposta foreign key (nome_disciplina) references disciplina (id),
	constraint fkresposta_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkresposta_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkresposta_4 foreign key (id_turma) references turma (id),
	constraint fkresposta_5 foreign key (numero_questao) references questao (id)
);

create table arquivo_resposta (
	id serial not null,
	nome_disciplina int not null,
	ano_ofertado int not null,
	semestre_ofertado int not null,
	id_turma int not null,
	numero_questao int not null,
	ra_aluno int not null,
	arquivo_resposta varchar (500) not null,
	constraint pkArquivosResposta primary key (id),
	constraint ucArquivosResposta unique (nome_disciplina, ano_ofertado, semestre_ofertado, id_turma, numero_questao, ra_aluno, arquivo_resposta),
	constraint fkArquivosResposta foreign key (nome_disciplina) references disciplina (id),
	constraint fkArquivosResposta_2 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkArquivosResposta_3 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkArquivosResposta_4 foreign key (id_turma) references turma (id),
	constraint fkArquivosResposta_5 foreign key (numero_questao) references questao (id),
	constraint fkArquivosResposta_6 foreign key (ra_aluno) references core_aluno (user_id)
);

Create table matricula (
	id serial not null,
	ra_aluno int,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	constraint pkmatricula primary key (id),
	constraint ucmatricula unique (ra_aluno, nome_disciplina, ano_ofertado, semestre_ofertado, id_turma),
	constraint fkmatricula foreign key (ra_aluno) references core_aluno (user_id),
	constraint fkmatricula_2 foreign key (nome_disciplina) references disciplina (id),
	constraint fkmatricula_3 foreign key (ano_ofertado) references disciplina_ofertada (id),	
	constraint fkmatricula_4 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkmatricula_5 foreign key (id_turma) references turma (id)
);

Create table curso_turma (
	id serial not null,
	sigla_curso int,
	nome_disciplina int,
	ano_ofertado int,
	semestre_ofertado int,
	id_turma int,
	constraint pkCursoTurma primary key (id),
	constraint ucCursoTurma unique (sigla_curso, nome_disciplina, ano_ofertado, semestre_ofertado, id_turma),
	constraint fkCursoTurma foreign key (sigla_curso) references cursos (id),
	constraint fkCursoTurma_2 foreign key (nome_disciplina) references disciplina (id),
	constraint fkCursoTurma_3 foreign key (ano_ofertado) references disciplina_ofertada (id),
	constraint fkCursoTurma_4 foreign key (semestre_ofertado) references disciplina_ofertada (id),
	constraint fkCursoTurma_5 foreign key (id_turma) references turma (id)
);

SELECT * FROM curso;
SELECT * FROM disciplina;
SELECT * FROM matricula;
SELECT * FROM core_usuario;
SELECT * FROM core_aluno;
SELECT * FROM core_professor;
SELECT * FROM arquivo_resposta;
SELECT * FROM arquivo_questao;
SELECT * FROM curso_turma;
SELECT * FROM grade_curricular;
SELECT * FROM questao;
SELECT * FROM resposta;
SELECT * FROM disciplina_ofertada;
SELECT * FROM periodo;
SELECT * FROM periodo_disciplina;
SELECT * FROM turma;
SELECT * FROM codigo_matricula;